---
description: Guidelines for maintaining project context documentation
globs: .cursor/context.md,.cursor/context/**
alwaysApply: false
---

# Context Documentation Maintenance

## Documentation Hierarchy

**Source of Truth**: `.cursor/context/` folder contains detailed documentation:
- `api.md` - tRPC routes, auth endpoints, procedure types, error responses
- `architecture.md` - System overview, data flow patterns, layer responsibilities
- `high-level-architecture.md` - Living visual doc with route map, feature flows, data relationships, changelog (maintained by architecture-tracker subagent)
- `data-models.md` - Schema, entity relationships, tables overview, migrations
- `features.md` - Feature documentation with flow diagrams and key files
- `integrations.md` - External services (Cloudflare, Better Auth, Stripe, PostHog)
- `security.md` - Auth flow, session management, authorization, RBAC
- `user-journeys.md` - User flows, admin journeys, error states

**Quick Reference**: `.cursor/context.md` is a compressed index that:
- Points agents to detailed docs in `.cursor/context/`
- Provides compressed indices of rules and context docs
- Contains brief overview, tech stack summary, and recent changes
- Enables fast retrieval without reading full documentation

## Compression Philosophy (for context.md)

- **Target**: 80%+ reduction from verbose docs
- **Goal**: Agent can quickly understand project structure and know where to look for details
- **Approach**: Pipe-delimited indices point to full docs rather than embedding them

## Pipe-Delimited Index Format

```
[Index Name]|root: path/to/files/
|IMPORTANT: Key instruction for the agent
|file1.ext: brief description of contents
|file2.ext: brief description of contents
|subdir/:{file-a.ext,file-b.ext,...}
```

### Format Rules

- First line: `[Index Name]|root: base/path/`
- Critical instructions prefixed with `|IMPORTANT:` or `|CRITICAL:`
- One item per line, prefixed with `|`
- Directories with multiple files use `dirname/:{file1,file2,...}` syntax
- Descriptions separated by `:` - keep under 80 chars

## context.md Required Sections

1. **Agent Instructions** - Retrieval-led reasoning directive
2. **Context Docs Index** - Compressed index of `.cursor/context/` detailed docs
3. **Rules Index** - Compressed index of `.cursor/rules/`
4. **Overview** - One sentence project description
5. **Tech Stack** - Key technologies (framework, runtime, db, auth, styling)
6. **Architecture** - High-level patterns (2-4 bullet points)
7. **Features** - Brief summaries with key files (3-5 lines max)
8. **Recent Changes** - Last 3-4 significant changes (newest first)

## When to Update

### Update detailed docs (`.cursor/context/`) when:
- Implementing new features → `features.md`
- Adding API routes → `api.md`
- Changing architecture → `architecture.md`
- Modifying schema → `data-models.md`
- Adding integrations → `integrations.md`
- Changing auth/security → `security.md`
- New user flows → `user-journeys.md`

### Update context.md index when:
- A context doc's scope changes (update the index entry)
- Adding new rules to `.cursor/rules/`
- Adding significant new features (brief summary)
- Adding new tech stack components

### Update high-level-architecture.md when:
- Adding new routes (update Route Map + Information Architecture table)
- Implementing new features (add Feature Flow section)
- Schema changes (update Data Relationships ER diagram)
- Architectural decisions (update System Architecture)
- **Always add a Changelog entry with date**

Use the `architecture-tracker` subagent to maintain this document.

## Example: Adding a New Rule to context.md

```diff
 |emails.mdc: Email templates in constants, generator functions, Resend SDK, inline CSS
+|notifications.mdc: Push notifications, in-app alerts, email digests, user preferences
 |stripe.mdc: Stripe client from ctx.stripe (never create in repos), webhook handling
```

## Example: Adding a New Feature

First, add detailed documentation to `features.md`:

```markdown
### Notifications
Real-time push notifications and in-app alerts for user engagement.

**Data Model**:
- `notification` table with type, content, read status, created_at
- Foreign key to user

**Key Files**:
- `app/routes/notifications/` - Notification center UI
- `app/repositories/notification.ts` - Data access
- `app/trpc/routes/notifications.ts` - API routes

**Flow**:
[Mermaid diagram here]
```

Then add a brief summary to context.md Features section:

```markdown
### Notifications
Real-time push notifications via WebSockets with in-app notification center.
**Key files**: `app/routes/notifications/`, `app/repositories/notification.ts`
```

Keep context.md feature descriptions to 3-5 lines max.
